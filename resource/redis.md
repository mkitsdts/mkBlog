---
title: Redis
created_time: 2025-5-1
updated_time: 2025-5-1
category: Database
tags: study node
author: mkitsdts
---

# Redis 对象

redis 里面有许多对象，比如字符串 string ， 列表 list ，哈希表 hash ， 集合 set 和 有序集合 zset 。为了实现 redis 对象， redis 源码里实现了大量的数据结构，每个对象的实现或是依赖其中一种数据结构，或是混合多种数据结构的实现。

# Redis 底层数据结构

redis 底层数据结构目前有 SDS（simple dynamic string，简单动态字符串）， quicklist （快速列表）， listpack （）， 哈希表， 整数集合， 跳表 ...

##  SDS（简单动态字符串）

众所周知，C语言本身有使用指针实现的字符串，这种没有记录字符串长度，也没有安全检查的字符串过于拉跨以至于用过的人都对此嗤之以鼻。所以 redis 也是造了一个字符串，就叫 SDS 。

SDS 用一个字符数组存储字符串，有一个 len 表示字符串长度，一个 alloc 表示字符数字长度，还有一个 flags 表示 字符串存储的类型。这样就解决了 C语言 字符串的问题，成为一个现代的字符串了。下面来对比分析一下 redis 里的 SDS

* 获取字符串长度 
C语言 里需要遍历字符串计算长度，时间复杂度 O(n)
SDS 只需要直接返回 len 的值就好了，时间复杂度 O(1) 完爆 C语言

* 安全问题
C语言 里需要结束符表示字符串的结尾，如果结束符被修改或者使用了 strcat 函数就容易出现越界访问，后果不堪设想
SDS 记录了字符串长度，可以有效避免越界访问，是安全的

我不禁要问 flags 用来做什么的
前面提到的 flags 标签，其实是为了区分字符串可能的最大长度，小一点的字符串最大可能是 2^8 个字节，那只需要 1个字节 记录长度就够了，如果是大一些的字符串比如说 2^16 甚至 2^32 个字节，那需要 2个字节或者4个字节 来记录长度

## list （列表）

所谓列表其实链表， C语言 没有提供链表结构，需要自行实现。 redis 里的链表是双向链表，非常简单不多说

## hash （哈希）

数组实现的哈希表，通过 链式哈希 的方法解决哈希冲突

## set （整数集合）

本质就是一个整数数组，但是 redis 实现里动态确定整数数组的类型。下面介绍一下参数。
- contents 保存元素的数组
- length 数组的长度
- encoding 数组编码方式，确定 contents 到底是16位还是32位或者64位

如果有更高一级的元素加入集合，集合会自动进行升级操作，即将 contents 转换成更高一级的数组

## skiplist （跳表）

跳表的出现是为了解决链表查询效率过低的问题。

链表查询效率低是因为链表需要逐个节点访问查询，为了解决这个问题，我们可以借鉴哈希表的思路，将哈希表和链表混合起来。具体说就是给节点分组，同一组的节点通过数组储存，每组之间通过链表连接，这样可以快速定位到组，然后顺序遍历数组找到目标元素。分组的依据是用户填写的数值

## listpack